<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Queen - ·∫§n B·∫£n ƒê·∫∑c Bi·ªát 20.10</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Manrope:wght@200..800&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-serif: 'Lora', serif;
            --font-sans: 'Manrope', sans-serif;
            --color-gold: #c9ab81;
            --color-dark: #1a1a1a;
            --color-light: #fdfdfd;
            --color-paper: #f0ede9;
            --color-text: #333;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-sans);
            background-color: var(--color-dark);
            color: var(--color-text);
            overflow-x: hidden;
            line-height: 1.6;
            cursor: default;
        }
        
        /* === Con tr·ªè chu·ªôt t√πy ch·ªânh === */
        .custom-cursor {
            position: fixed;
            width: 25px;
            height: 25px;
            border: 2px solid var(--color-gold);
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, background-color 0.2s;
            z-index: 9999;
        }

        /* --- M√†n r√®m kh√≥a --- */
        #curtain-lock-screen {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2000;
        }
        .curtain {
            position: absolute; top: 0; width: 50%; height: 100%;
            background-image: linear-gradient(to right, #6d0019, #a11d33, #6d0019);
            box-shadow: 0 0 25px rgba(0,0,0,0.7) inset;
            transition: transform 2.5s cubic-bezier(0.87, 0, 0.13, 1);
        }
        .curtain::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.6) 100%),
                        url('https://www.transparenttextures.com/patterns/fabric-of-squares.png');
        }
        .left-curtain { left: 0; }
        .right-curtain { right: 0; }
        #curtain-lock-screen.open .left-curtain { transform: translateX(-100%); }
        #curtain-lock-screen.open .right-curtain { transform: translateX(100%); }

        .password-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            z-index: 1001; display: flex; justify-content: center; align-items: center;
            transition: opacity 1s 2s;
        }
        #curtain-lock-screen.open .password-overlay { opacity: 0; pointer-events: none; }
        .password-box {
            background: rgba(26, 26, 26, 0.8); border: 1px solid var(--color-gold);
            color: white; padding: 40px; border-radius: 10px; text-align: center;
        }
        #password-input {
            font-size: 2rem; width: 200px; text-align: center; border: none;
            border-bottom: 2px solid var(--color-gold); background: transparent; color: white;
            letter-spacing: 20px; margin-top: 20px;
        }
        #password-input:focus { outline: none; }
        .password-box.shake { animation: shake 0.5s; }
        @keyframes shake {
            10%, 90% { transform: translateX(-5px); } 20%, 80% { transform: translateX(5px); }
            30%, 50%, 70% { transform: translateX(-3px); } 40%, 60% { transform: translateX(3px); }
        }

        /* --- N√∫t ƒëi·ªÅu khi·ªÉn nh·∫°c n·ªÅn --- */
        #music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--color-gold);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            backdrop-filter: blur(5px);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        #music-control:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px var(--color-gold);
        }

        /* --- C·∫§U TR√öC TRANG & HI·ªÜU ·ª®NG --- */
        .page {
            width: 100%;
            min-height: 100vh;
            padding: 10vh 10vw;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            transition: transform 1s cubic-bezier(0.25, 1, 0.5, 1), opacity 1s;
            transform: scale(0.9);
            opacity: 0;
        }
        .page.is-visible {
            transform: scale(1);
            opacity: 1;
        }

        .page-content {
            width: 100%; max-width: 1200px; z-index: 2; position: relative;
        }
        .animated {
            opacity: 0; transform: translateY(50px);
            transition: opacity 1s, transform 1s;
        }
        .is-visible .animated {
            opacity: 1; transform: translateY(0);
        }
        .animated.delay-1 { transition-delay: 0.3s; }
        .animated.delay-2 { transition-delay: 0.5s; }
        .animated.delay-3 { transition-delay: 0.7s; }

        /* === C·∫£i thi·ªán: Hi·ªáu ·ª©ng B·ª§I V√ÄNG L·∫§P L√ÅNH === */
        .sparkle-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 1; overflow: hidden;
        }
        .sparkle {
            position: absolute;
            width: 3px; height: 3px;
            background-color: var(--color-gold);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--color-gold);
            animation: sparkle-anim 2s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; /* L√†m m∆∞·ª£t animation */
            opacity: 0;
        }
        @keyframes sparkle-anim {
            0% { transform: scale(0) translateY(0); opacity: 0; }
            20% { opacity: 1; }
            80% { transform: scale(1.2) translateY(-100px); opacity: 0.8; }
            100% { transform: scale(0.5) translateY(-150px); opacity: 0; }
        }

        /* --- Trang B√¨a --- */
        #cover-page { background-color: var(--color-dark); color: white; }
        #cover-page .page-content { display: flex; align-items: center; gap: 5%; }
        .cover-image { width: 35%; border: 15px solid var(--color-light); box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .cover-text { flex: 1; text-align: left; }
        .magazine-title { font-family: var(--font-serif); font-size: 2rem; letter-spacing: 5px; opacity: 0.8; }
        .headline { font-family: var(--font-serif); font-size: 6rem; color: var(--color-gold); line-height: 1.1; margin: 20px 0; }
        .tits p { font-size: 1.1rem; margin-bottom: 15px; opacity: 0.9; }

        /* --- Trang Fashion --- */
        #fashion-page { background-color: var(--color-paper); }
        #fashion-page .page-content { display: flex; align-items: center; gap: 5%; }
        .fashion-text { width: 45%; }
        .fashion-text h2 { font-family: var(--font-serif); font-size: 4.5rem; color: var(--color-dark); }
        .fashion-text .quote { font-style: italic; font-size: 1.2rem; margin: 30px 0; padding-left: 20px; border-left: 3px solid var(--color-gold); }
        .fashion-gallery {
            width: 50%; position: relative; height: 60vh;
            perspective: 1000px; /* Th√™m ph·ªëi c·∫£nh cho hi·ªáu ·ª©ng 3D */
        }
        .fashion-gallery img {
            position: absolute; width: 60%;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border: 8px solid white;
            transition: transform 0.8s cubic-bezier(0.25, 1, 0.5, 1), box-shadow 0.3s; /* L√†m m∆∞·ª£t chuy·ªÉn ƒë·ªông */
            will-change: transform; /* T·ªëi ∆∞u h√≥a hi·ªáu su·∫•t */
        }
        /* C·∫≠p nh·∫≠t v·ªã tr√≠ ·∫£nh ƒë·ªÉ hi·ªáu ·ª©ng hover t·ª± nhi√™n h∆°n */
        .fashion-gallery img:nth-child(1) { top: 10%; left: 10%; transform: rotate(-8deg); }
        .fashion-gallery img:nth-child(2) { bottom: 10%; right: 10%; transform: rotate(10deg); }
        
        /* Hi·ªáu ·ª©ng m·ªõi cho trang Fashion: Khi hover v√†o gallery */
        .fashion-gallery:hover img:nth-child(1) { transform: rotate(-2deg) translateY(-20px) scale(1.05); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .fashion-gallery:hover img:nth-child(2) { transform: rotate(5deg) translateY(20px) scale(1.05); box-shadow: 0 20px 40px rgba(0,0,0,0.3); }

        /* G·ª° b·ªè hi·ªáu ·ª©ng hoa n·ªü CSS */
        /* #flower-container kh√¥ng c√≤n c·∫ßn thi·∫øt */

        /* --- Trang Game --- */
        #game-page {
            background-image: linear-gradient(rgba(10, 25, 47, 0.9), rgba(10, 25, 47, 0.9)), url('https://images.pexels.com/photos/1190297/pexels-photo-1190297.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
            background-size: cover; background-attachment: fixed; color: white; text-align: center;
        }
        #game-page .page-content { display: flex; justify-content: center; align-items: center; }
        #game-container { width: 90%; height: 80vh; max-width: 1000px; background: rgba(0,0,0,0.4); border: 1px solid var(--color-gold); border-radius: 15px; overflow: hidden; position: relative; }
        #gameCanvas { width: 100%; height: 100%; }
        #game-score { position: absolute; top: 20px; left: 30px; font-size: 2.5rem; font-family: var(--font-serif); text-shadow: 0 0 10px black; }
        #game-rules-popup, #game-result { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        #game-rules-popup h3, #game-result h3 { font-family: var(--font-serif); font-size: 4rem; color: var(--color-gold); }
        #game-rules-popup button { padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; background: var(--color-gold); color: var(--color-dark); cursor: pointer; font-weight: 600; margin-top: 20px; transition: transform 0.2s; }
        #game-rules-popup button:hover { transform: scale(1.05); }
        #game-result { display: none; }

        /* --- Trang Fan Mail --- */
        #fanmail-page { background-color: #d1e4dd; display: flex; align-items: center; justify-content: center;}
        #fanmail-page .page-content { display: flex; justify-content: center; align-items: center; gap: 50px; flex-wrap: wrap; } /* ƒê·∫£m b·∫£o n·ªôi dung cƒÉn gi·ªØa v√† c√≥ kho·∫£ng c√°ch */

        .chat-window {
            width: 400px; height: 75vh;
            background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png');
            border: 10px solid black; border-radius: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex; flex-direction: column;
            position: relative; /* ƒê·ªÉ ƒë·∫∑t ·∫£nh b√™n trong */
        }
        .chat-header { padding: 15px; text-align: center; background: #005C4B; color: white; font-weight: 600; border-top-left-radius: 30px; border-top-right-radius: 30px; }
        .message-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message-bubble { padding: 10px 15px; border-radius: 18px; max-width: 70%; line-height: 1.5; opacity: 0; transform: translateY(20px); transition: 0.5s; }
        .message-bubble.visible { opacity: 1; transform: translateY(0); }
        .message-bubble.sender { background-color: #dcf8c6; align-self: flex-end; border-bottom-right-radius: 4px; color: black; }
        
        /* === M·ªöI: ·∫¢nh trong ph·∫ßn Fan Mail === */
        .fanmail-image-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        .fanmail-image {
            width: 250px;
            height: 350px;
            object-fit: cover;
            border: 8px solid white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border-radius: 5px;
            opacity: 0;
            transform: scale(0.8) rotate(5deg);
            transition: opacity 1s, transform 1s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .fanmail-image.visible {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        .fanmail-image:nth-child(odd) { transform: scale(0.8) rotate(-5deg); }


        /* --- Trang Cu·ªëi --- */
        #back-cover-page { background-color: var(--color-paper); text-align: center; }
        .back-cover-image { width: 60%; max-width: 700px; border: 20px solid white; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .back-cover-text { font-family: var(--font-serif); font-size: 3rem; margin-top: 40px; }
        .credits { font-size: 1rem; font-style: italic; color: #777; margin-top: 20px; }

        /* --- Responsive Design --- */
        @media (max-width: 1024px) {
            .page { padding: 10vh 5vw; } .headline { font-size: 5rem; } .fashion-text h2 { font-size: 3.5rem; } #game-rules-popup h3, #game-result h3 { font-size: 3rem; }
            #fanmail-page .page-content { flex-direction: column; gap: 30px; } /* X·∫øp d·ªçc tr√™n tablet */
        }
        @media (max-width: 768px) {
            .page { min-height: auto; padding: 15vw 5vw; }
            #cover-page .page-content { flex-direction: column; text-align: center; }
            .cover-image { width: 80%; margin-bottom: 30px; } .cover-text { text-align: center; } .headline { font-size: 4rem; }
            #fashion-page .page-content { flex-direction: column; }
            .fashion-text { width: 100%; text-align: center; }
            .fashion-text .quote { margin: 20px auto; border: none; border-top: 3px solid var(--color-gold); border-bottom: 3px solid var(--color-gold); padding: 15px 0; }
            .fashion-gallery { width: 100%; height: 50vh; margin-top: 40px; } .fashion-gallery img { width: 65%; }
            #game-container { height: 60vh; }
            #game-rules-popup h3, #game-result h3 { font-size: 2.5rem; } #game-rules-popup p { font-size: 0.9rem; }
            .chat-window { width: 90vw; height: 70vh; }
            .back-cover-image { width: 90%; } .back-cover-text { font-size: 2rem; }
            .fanmail-image { width: 200px; height: 280px; }
        }
    </style>
</head>
<body>
    <div class="custom-cursor"></div>

    <div id="curtain-lock-screen">
        <div class="curtain left-curtain"></div>
        <div class="curtain right-curtain"></div>
        <div class="password-overlay" id="password-overlay">
            <div class="password-box" id="password-box">
                <h2>M·ªôt M√≥n Qu√† B·∫•t Ng·ªù</h2>
                <p>Nh·∫≠p m·∫≠t kh·∫©u (ddmm)</p>
                <input type="password" id="password-input" maxlength="4" autocomplete="off">
            </div>
        </div>
    </div>

    <div id="music-control" style="display: none;">üéµ</div>

    <main id="magazine-content">
        <section id="cover-page" class="page">
            <div class="sparkle-container"></div>
            <div class="page-content">
                <img src="anh/anh_bia.jpg" alt="·∫¢nh b√¨a" class="cover-image animated">
                <div class="cover-text">
                    <p class="magazine-title animated delay-1">The Queen</p>
                    <h1 class="headline animated delay-2">20.10</h1>
                    <div class="tits animated delay-3">
                        <p>‚Ä¢ Nhan s·∫Øc v∆∞·ª£t th·ªùi gian</p>
                        <p>‚Ä¢ Phong c√°ch c·ªßa m·ªôt bi·ªÉu t∆∞·ª£ng</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="fashion-page" class="page">
            <div class="page-content">
                <div class="fashion-text">
                    <h2 class="animated">Fashionista</h2>
                    <p class="quote animated delay-1">"Phong c√°ch l√† c√°ch ƒë·ªÉ n√≥i b·∫°n l√† ai m√† kh√¥ng c·∫ßn ph·∫£i t·ªën m·ªôt l·ªùi."</p>
                    <p class="animated delay-2">T·ª´ nh·ªØng kho·∫£nh kh·∫Øc ƒë·ªùi th∆∞·ªùng ƒë·∫øn nh·ªØng d·ªãp ƒë·∫∑c bi·ªát, th·∫ßn th√°i v√† gu th·∫©m m·ªπ c·ªßa m·∫π lu√¥n l√† ngu·ªìn c·∫£m h·ª©ng b·∫•t t·∫≠n.</p>
                </div>
                <div class="fashion-gallery animated delay-3">
                    <img src="anh/anh1.jpg" alt="·∫¢nh 1">
                    <img src="anh/anh2.jpg" alt="·∫¢nh 2">
                </div>
            </div>
        </section>

        <section id="game-page" class="page">
             <div class="sparkle-container"></div>
            <div class="page-content">
                <div id="game-container">
                    <canvas id="gameCanvas"></canvas>
                    <div id="game-score">ƒêi·ªÉm: 0</div>
                    <div id="game-rules-popup">
                        <h3>Idol Challenge</h3>
                        <p>Di chuy·ªÉn üé§ ƒë·ªÉ h·ª©ng qu√†, n√© bom!<br>ƒê·∫°t 80 ƒëi·ªÉm ƒë·ªÉ chi·∫øn th·∫Øng!</p>
                        <button id="startGameBtn">B·∫Øt ƒë·∫ßu!</button>
                    </div>
                    <div id="game-result"><h3 id="result-message"></h3></div>
                </div>
            </div>
        </section>
        
        <section id="fanmail-page" class="page">
            <div class="page-content">
                <div class="chat-window animated">
                    <div class="chat-header">Tin nh·∫Øn t·ª´ Fan C·ª©ng</div>
                    <div class="message-area"></div>
                </div>
                <div class="fanmail-image-container">
                    <img src="anh/anh3.jpg" alt="·∫¢nh fanmail 1" class="fanmail-image">
                    <img src="anh/anhgiadinh.jpg" alt="·∫¢nh fanmail 2" class="fanmail-image">
                </div>
            </div>
        </section>

        <section id="back-cover-page" class="page">
             <div class="page-content">
                <img src="anh/anhgiadinh.jpg" alt="·∫¢nh gia ƒë√¨nh" class="back-cover-image animated">
                <p class="back-cover-text animated delay-1">C·∫£m ∆°n m·∫π v√¨ ƒë√£ l√† ngu·ªìn c·∫£m h·ª©ng v√¥ t·∫≠n.</p>
                <p class="credits animated delay-2">Bi√™n t·∫≠p: M·ªôt m√¨nh Bi :3</p>
            </div>
        </section>
    </main>

    <audio id="backgroundMusic" src="anh/am_nhac.mp3" loop></audio>
    <audio id="collectSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b33a52239.mp3"></audio>
    <audio id="bombSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_c483740443.mp3"></audio>
    <audio id="winSound" src="https://cdn.pixabay.com/audio/2022/11/17/audio_88b22280a5.mp3"></audio>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- M√†n h√¨nh kh√≥a ---
        const curtainScreen = document.getElementById('curtain-lock-screen');
        const passwordInput = document.getElementById('password-input');
        const passwordBox = document.getElementById('password-box');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const musicControl = document.getElementById('music-control');

        passwordInput.addEventListener('input', () => {
            if (passwordInput.value === '0901') {
                curtainScreen.classList.add('open');
                setTimeout(() => curtainScreen.style.display = 'none', 3000);
                
                backgroundMusic.volume = 0.4;
                backgroundMusic.play().catch(e => console.log("Tr√¨nh duy·ªát ch·∫∑n t·ª± ƒë·ªông ph√°t nh·∫°c."));
                musicControl.style.display = 'flex';
                musicControl.textContent = 'üéµ';

            } else if (passwordInput.value.length >= 4) {
                passwordBox.classList.add('shake');
                setTimeout(() => { passwordBox.classList.remove('shake'); passwordInput.value = ''; }, 500);
            }
        });

        // X·ª≠ l√Ω n√∫t b·∫≠t/t·∫Øt nh·∫°c n·ªÅn
        musicControl.addEventListener('click', () => {
            if (backgroundMusic.paused) {
                backgroundMusic.play();
                musicControl.textContent = 'üéµ';
            } else {
                backgroundMusic.pause();
                musicControl.textContent = 'üîá';
            }
        });

        // N√¢ng c·∫•p: Hi·ªáu ·ª©ng khi cu·ªôn, k·∫øt h·ª£p c√°c hi·ªáu ·ª©ng m·ªõi
        const pages = document.querySelectorAll('.page');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    // K√≠ch ho·∫°t hi·ªáu ·ª©ng ri√™ng cho t·ª´ng trang khi n√≥ xu·∫•t hi·ªán
                    if (entry.target.id === 'fanmail-page') {
                        startFanMailAnimation();
                        // M·ªöI: K√≠ch ho·∫°t ·∫£nh trong Fanmail
                        document.querySelectorAll('.fanmail-image').forEach((img, index) => {
                            setTimeout(() => img.classList.add('visible'), 500 + index * 300);
                        });
                    }
                    // G·ª° b·ªè activateFlowerEffect()
                    if (entry.target.querySelector('.sparkle-container')) {
                        activateSparkleEffect(entry.target);
                    }
                } else {
                     entry.target.classList.remove('is-visible');
                     // ƒê·∫∑t l·∫°i tr·∫°ng th√°i ·∫£nh trong Fanmail khi kh√¥ng c√≤n hi·ªÉn th·ªã
                     if (entry.target.id === 'fanmail-page') {
                        document.querySelectorAll('.fanmail-image').forEach(img => {
                            img.classList.remove('visible');
                        });
                     }
                }
            });
        }, { threshold: 0.3 });
        pages.forEach(page => observer.observe(page));

        // Hi·ªáu ·ª©ng con tr·ªè chu·ªôt t√πy ch·ªânh
        const cursor = document.querySelector('.custom-cursor');
        window.addEventListener('mousemove', e => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });

        // === Logic Game (Gi·ªØ nguy√™n) ===
        const gameContainer = document.getElementById('game-container');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('game-score');
        const rulesPopup = document.getElementById('game-rules-popup');
        const resultScreen = document.getElementById('game-result');
        const resultMessage = document.getElementById('result-message');
        const audio = {
            collect: document.getElementById('collectSound'),
            bomb: document.getElementById('bombSound'),
            win: document.getElementById('winSound')
        };
        let score, player, items, gameLoopId, itemInterval;
        function resizeCanvas() { canvas.width = gameContainer.clientWidth; canvas.height = gameContainer.clientHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();
        document.getElementById('startGameBtn').addEventListener('click', () => { rulesPopup.style.display = 'none'; resizeCanvas(); startGame(); });
        function startGame() {
            score = 0; items = []; gameLoopId = null;
            scoreEl.textContent = `ƒêi·ªÉm: ${score}`;
            player = { x: canvas.width / 2 - 25, y: canvas.height - 70, width: 50, height: 60, emoji: 'üé§' };
            itemInterval = setInterval(spawnItem, 500);
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        function gameLoop() { updateGame(); if(gameLoopId) requestAnimationFrame(gameLoop); }
        const itemTypes = [{ emoji: '‚ù§Ô∏è', value: 5, type: 'good' }, { emoji: '‚≠ê', value: 10, type: 'good' }, { emoji: 'üí£', value: -15, type: 'bad' }];
        function spawnItem() { const type = itemTypes[Math.floor(Math.random() * itemTypes.length)]; items.push({ x: Math.random() * (canvas.width - 40), y: -40, size: 40, speed: 2 + Math.random() * 3, ...type }); }
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = '50px sans-serif'; ctx.fillText(player.emoji, player.x, player.y);
            items.forEach((item, index) => {
                item.y += item.speed; ctx.font = `${item.size}px sans-serif`; ctx.fillText(item.emoji, item.x, item.y);
                if (item.y > canvas.height) items.splice(index, 1);
                if (player.x < item.x + item.size && player.x + player.width > item.x && player.y < item.y + item.size && player.y + player.height > item.y) {
                    score = Math.max(0, score + item.value); scoreEl.textContent = `ƒêi·ªÉm: ${score}`; items.splice(index, 1);
                    (item.type === 'good' ? audio.collect : audio.bomb).play();
                    if (score >= 80) endGame(true);
                }
            });
        }
        function endGame(isWin) {
            cancelAnimationFrame(gameLoopId); gameLoopId = null; clearInterval(itemInterval);
            resultScreen.style.display = 'flex'; resultMessage.textContent = isWin ? "XU·∫§T S·∫ÆC!" : "C·ªë L√™n N√†o!";
            if (isWin) audio.win.play();
            if (!document.getElementById('replayBtn')) {
                const replayBtn = document.createElement('button'); replayBtn.id = 'replayBtn'; replayBtn.textContent = 'Ch∆°i l·∫°i';
                replayBtn.style.cssText = "padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; background: var(--color-gold); color: var(--color-dark); cursor: pointer; font-weight: 600; margin-top: 20px;";
                replayBtn.onclick = () => { resultScreen.style.display = 'none'; rulesPopup.style.display = 'flex'; };
                resultScreen.appendChild(replayBtn);
            }
        }
        function movePlayer(clientX) { if (!player) return; const rect = canvas.getBoundingClientRect(); let targetX = clientX - rect.left - player.width / 2; player.x = Math.max(0, Math.min(targetX, canvas.width - player.width)); }
        canvas.addEventListener('mousemove', e => movePlayer(e.clientX)); canvas.addEventListener('touchmove', e => { e.preventDefault(); movePlayer(e.touches[0].clientX); });

        // === Fan Mail Animation (Gi·ªØ nguy√™n) ===
        const messages = [{ text: "Hi Mom!", sticker: false }, { text: "ü•∞", sticker: true }, { text: "Ch√∫c m·∫π m·ªôt ng√†y 20/10 th·∫≠t nhi·ªÅu ni·ªÅm vui v√† h·∫°nh ph√∫c ·∫°!", sticker: false }, { text: "M·∫π m√£i l√† ng∆∞·ªùi ph·ª• n·ªØ tuy·ªát v·ªùi nh·∫•t trong l√≤ng con! Y√™u m·∫π! ‚ù§Ô∏è", sticker: false }];
        function startFanMailAnimation() {
            const messageArea = document.querySelector('.message-area'); if(messageArea.children.length > 0) return; let delay = 500;
            messages.forEach(msg => {
                setTimeout(() => {
                    const bubble = document.createElement('div'); bubble.classList.add('message-bubble', 'sender');
                    if (msg.sticker) { bubble.style.background = 'none'; bubble.style.fontSize = '3rem'; }
                    bubble.textContent = msg.text; messageArea.appendChild(bubble);
                    setTimeout(() => bubble.classList.add('visible'), 50);
                    messageArea.scrollTop = messageArea.scrollHeight;
                }, delay);
                delay += 1500;
            });
        }
        
        // === G·ª° b·ªè hi·ªáu ·ª©ng hoa n·ªü ===
        // const fashionPage = document.getElementById('fashion-page');
        // const flowerContainer = document.getElementById('flower-container');
        // let flowerInterval;
        // function createFlower(x, y) { /* ... */ }
        // function activateFlowerEffect() { /* ... */ }

        // M·ªöI: Hi·ªáu ·ª©ng b·ª•i v√†ng l·∫•p l√°nh (C·∫£i ti·∫øn ƒë·ªô m∆∞·ª£t)
        function activateSparkleEffect(page) {
            if (page.dataset.sparkleActive) return;
            page.dataset.sparkleActive = 'true';
            
            const sparkleContainer = page.querySelector('.sparkle-container');
            let lastX = -1, lastY = -1;
            let currentSparkles = []; // Theo d√µi c√°c h·∫°t b·ª•i ƒëang ho·∫°t ƒë·ªông

            const handleMouseMove = (e) => {
                const rect = page.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                // T·∫°o h·∫°t b·ª•i ch·ªâ khi chu·ªôt di chuy·ªÉn ƒë·ªß xa
                if (Math.abs(x - lastX) > 10 || Math.abs(y - lastY) > 10) { // ƒêi·ªÅu ch·ªânh ng∆∞·ª°ng n√†y
                    createSparkle(x, y, sparkleContainer);
                    lastX = x;
                    lastY = y;
                }
            };
            page.addEventListener('mousemove', handleMouseMove);

            // T·∫°o hi·ªáu ·ª©ng b·ª•i v√†ng li√™n t·ª•c (c√≥ th·ªÉ ƒëi·ªÅu ch·ªânh t·∫ßn su·∫•t)
            const continuousSparkleInterval = setInterval(() => {
                if (sparkleContainer.offsetHeight > 0) { // Ch·ªâ t·∫°o khi container hi·ªÉn th·ªã
                    const x = Math.random() * page.clientWidth;
                    const y = Math.random() * page.clientHeight;
                    createSparkle(x, y, sparkleContainer);
                }
            }, 100); // T·∫ßn su·∫•t t·∫°o h·∫°t b·ª•i
        }

        function createSparkle(x, y, container) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = `${x + (Math.random() - 0.5) * 20}px`; // Th√™m m·ªôt ch√∫t ng·∫´u nhi√™n v·ªÅ v·ªã tr√≠
            sparkle.style.top = `${y + (Math.random() - 0.5) * 20}px`;
            sparkle.style.animationDelay = `${Math.random() * 0.5}s`; // Ng·∫´u nhi√™n ƒë·ªô tr·ªÖ
            container.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 2000); // Gi·ªØ nguy√™n th·ªùi gian animation
        }
    });
    </script>
</body>
</html>
