<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Queen - Ấn Bản Đặc Biệt 20.10</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Manrope:wght@200..800&display=swap" rel="stylesheet">
<style>
/* === BIẾN TOÀN CỤC & THIẾT LẬP CƠ BẢN === */
:root {
--font-serif: 'Lora', serif;
--font-sans: 'Manrope', sans-serif;
--color-gold: #c9ab81;
--color-dark: #1a1a1a;
--color-light: #fdfdfd;
--color-paper: #f0ede9;
--color-text: #333;
--ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
--cursor-x: 50vw;
--cursor-y: 50vh;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
font-family: var(--font-sans);
background-color: var(--color-dark);
color: var(--color-text);
overflow-x: hidden;
line-height: 1.6;
cursor: none;
/* NÂNG CẤP V2: Perspective cần cho hiệu ứng lật trang 3D */
perspective: 1500px;
}

/* === NÂNG CẤP MỚI V2: MÀN HÌNH CHỜ "SPLIT REVEAL" === */
#preloader {
position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 30000;
overflow: hidden;
}
.preloader-panel {
position: absolute; top: 0; width: 50%; height: 100%;
background-color: var(--color-dark);
transition: transform 1.5s cubic-bezier(0.87, 0, 0.13, 1);
}
.preloader-panel.left { left: 0; }
.preloader-panel.right { right: 0; }
#preloader.revealed .preloader-panel.left { transform: translateX(-100%); }
#preloader.revealed .preloader-panel.right { transform: translateX(100%); }
.preloader-text {
position: absolute; top: 50%; left: 50%;
transform: translate(-50%, -50%);
color: var(--color-gold);
font-family: var(--font-serif);
font-size: 2rem; letter-spacing: 4px;
opacity: 1;
transition: opacity 0.5s ease-out;
}
#preloader.revealed .preloader-text { opacity: 0; }


/* === NÂNG CẤP MỚI V2: HIỆU ỨNG "LENS FLARE" === */
#lens-flare {
position: fixed;
top: -100%; /* Bắt đầu ngoài màn hình */
left: -100%;
width: 500px;
height: 500px;
background: radial-gradient(circle, rgba(201, 171, 129, 0.2) 0%, rgba(201, 171, 129, 0) 60%);
border-radius: 50%;
pointer-events: none;
mix-blend-mode: color-dodge; /* Hòa trộn màu sắc đẹp mắt */
z-index: 9998;
opacity: 0;
transition: opacity 0.5s;
}
body.unlocked #lens-flare {
opacity: 1;
}

#scroll-progress-bar { position: fixed; top: 0; left: 0; height: 4px; background: var(--color-gold); width: 0%; z-index: 9999; transition: width 0.1s linear; }
.cursor { position: fixed; z-index: 10000; pointer-events: none; border-radius: 50%; transition: transform 0.2s var(--ease-out-expo); will-change: transform; }
.cursor.dot { width: 8px; height: 8px; background-color: var(--color-gold); transform: translate(-50%, -50%); }
.cursor.outline { width: 40px; height: 40px; border: 2px solid var(--color-gold); transform: translate(-50%, -50%); transition: transform 0.2s var(--ease-out-expo), width 0.3s, height 0.3s; }
body:hover .cursor.outline.hidden { width: 0; height: 0; }
.click-effect { position: fixed; border: 2px solid var(--color-gold); border-radius: 50%; animation: click-anim 0.5s var(--ease-out-expo) forwards; pointer-events: none; z-index: 9998; }
@keyframes click-anim { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(2); opacity: 0; } }
.spotlight-effect { background: radial-gradient( circle 300px at var(--cursor-x) var(--cursor-y), rgba(26, 26, 26, 0) 0%, rgba(26, 26, 26, 0.8) 80%, rgba(26, 26, 26, 0.95) 100% ); }

/* === Màn rèm khóa === */
#curtain-lock-screen {
position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 2000;
/* NÂNG CẤP V2: Ban đầu ẩn đi để preloader chạy trước */
visibility: hidden; opacity: 0; transition: opacity 1s 0.5s;
}
#curtain-lock-screen.visible { visibility: visible; opacity: 1; }
.curtain { position: absolute; top: 0; width: 50%; height: 100%; background-image: linear-gradient(to right, #6d0019, #a11d33, #6d0019); box-shadow: 0 0 25px rgba(0,0,0,0.7) inset; transition: transform 2.5s cubic-bezier(0.87, 0, 0.13, 1); }
.curtain::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(0,0,0,0.4) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.6) 100%), url('https://www.transparenttextures.com/patterns/fabric-of-squares.png'); }
.left-curtain { left: 0; } .right-curtain { right: 0; }
#curtain-lock-screen.open .left-curtain { transform: translateX(-100%); }
#curtain-lock-screen.open .right-curtain { transform: translateX(100%); }
.password-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 1001; display: flex; justify-content: center; align-items: center; transition: opacity 1s 2s; }
#curtain-lock-screen.open .password-overlay { opacity: 0; pointer-events: none; }
.password-box { background: rgba(26, 26, 26, 0.8); border: 1px solid var(--color-gold); color: white; padding: 40px; border-radius: 10px; text-align: center; }
#password-input { font-size: 2rem; width: 200px; text-align: center; border: none; border-bottom: 2px solid var(--color-gold); background: transparent; color: white; letter-spacing: 20px; margin-top: 20px; }
#password-input:focus { outline: none; }
.password-box.shake { animation: shake 0.5s; }
@keyframes shake { 10%, 90% { transform: translateX(-5px); } 20%, 80% { transform: translateX(5px); } 30%, 50%, 70% { transform: translateX(-3px); } 40%, 60% { transform: translateX(3px); } }

#music-control { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background-color: rgba(255, 255, 255, 0.1); border: 1px solid var(--color-gold); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: none; z-index: 1000; backdrop-filter: blur(5px); transition: transform 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
#music-control:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--color-gold); }

/* === NÂNG CẤP MỚI V2: HIỆU ỨNG LẬT TRANG 3D === */
.page {
width: 100%; min-height: 100vh; padding: 10vh 10vw; display: flex; justify-content: center; align-items: center;
position: relative; overflow: hidden;
opacity: 0;
/* Thời gian chuyển động */
transition: transform 1.8s var(--ease-out-expo), opacity 1s ease-in;
/* Vị trí ban đầu: trang được gấp lại ở bên phải */
transform-origin: left center;
transform: translateX(50%) rotateY(-90deg);
}
.page.is-visible {
opacity: 1;
/* Vị trí cuối cùng: trang được mở ra */
transform: translateX(0) rotateY(0deg);
}

.page-content { width: 100%; max-width: 1200px; z-index: 2; position: relative; }
.animated { opacity: 0; transform: translateY(50px); transition: opacity 1s var(--ease-out-expo), transform 1s var(--ease-out-expo); }
.is-visible .animated { opacity: 1; transform: translateY(0); }
.animated.delay-1 { transition-delay: 0.8s; } /* Tăng delay để khớp với hiệu ứng lật trang */
.animated.delay-2 { transition-delay: 1.0s; }
.animated.delay-3 { transition-delay: 1.2s; }

/* === Trang Bìa === */
#cover-page { background-color: var(--color-dark); color: white; }
#cover-page .page-content { display: flex; align-items: center; gap: 5%; }
#particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
.cover-image-wrapper {
width: 40%; position: relative; overflow: hidden; border: 15px solid var(--color-light);
box-shadow: 0 0 30px rgba(0,0,0,0.5); z-index: 2;
/* NÂNG CẤP MỚI V2: Áp dụng bộ lọc SVG */
filter: url(#image-ripple-filter);
}
.cover-image { width: 100%; display: block; }
.cover-text { flex: 1; text-align: left; z-index: 2; }
.magazine-title { font-family: var(--font-serif); font-size: 2rem; letter-spacing: 5px; opacity: 0.8; }
.headline { font-family: var(--font-serif); font-size: clamp(3rem, 10vw, 6rem); color: var(--color-gold); line-height: 1.1; margin: 20px 0; }
.headline .char { display: inline-block; opacity: 0; transform: translateY(30px) rotate(10deg); transition: opacity 0.6s var(--ease-out-expo), transform 0.6s var(--ease-out-expo); }
.tits p { font-size: 1.1rem; margin-bottom: 15px; opacity: 0.9; }

/* === Trang Fashion === */
#fashion-page { background-color: var(--color-paper); }
#fashion-page .page-content { display: flex; align-items: center; gap: 5%; }
.fashion-text { width: 45%; }
.fashion-text h2 { font-family: var(--font-serif); font-size: clamp(2.5rem, 8vw, 4.5rem); color: var(--color-dark); }
.fashion-text .quote { font-style: italic; font-size: 1.2rem; margin: 30px 0; padding-left: 20px; border-left: 3px solid var(--color-gold); }
.fashion-text p:first-of-type::first-letter { font-family: var(--font-serif); font-size: 4rem; color: var(--color-gold); float: left; line-height: 0.8; margin-right: 10px; padding-top: 5px; }
.fashion-gallery { width: 50%; position: relative; height: 60vh; perspective: 1000px; }
.fashion-gallery img { position: absolute; width: 60%; box-shadow: 0 15px 30px rgba(0,0,0,0.2); border: 8px solid white; transition: transform 0.5s var(--ease-out-expo), box-shadow 0.5s, z-index 0s 0.25s; will-change: transform; }
.fashion-gallery img:nth-child(1) { top: 10%; left: 10%; transform: rotate(-8deg); z-index: 1; }
.fashion-gallery img:nth-child(2) { bottom: 10%; right: 10%; transform: rotate(10deg); z-index: 2; }
.fashion-gallery img.is-active { z-index: 10; transform: scale(1.1) rotate(0deg) !important; box-shadow: 0 25px 50px rgba(0,0,0,0.3); transition: transform 0.5s var(--ease-out-expo), box-shadow 0.5s, z-index 0s 0s; }

/* === Trang Game === */
#game-page { background-image: url('https://i.pinimg.com/originals/11/49/71/114971c6b37452a325375496a0b.jpg'); background-size: cover; background-repeat: no-repeat; color: white; text-align: center; position: relative; }
#game-page .page-content { display: flex; justify-content: center; align-items: center; }
#game-container { width: 90%; height: 80vh; max-width: 1000px; background: rgba(0,0,0,0.4); border: 1px solid var(--color-gold); border-radius: 15px; overflow: hidden; position: relative; }
#gameCanvas { width: 100%; height: 100%; }
#game-score { position: absolute; top: 20px; left: 30px; font-size: 2.5rem; font-family: var(--font-serif); text-shadow: 0 0 10px black; }
#game-rules-popup, #game-result { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
#game-rules-popup h3, #game-result h3 { font-family: var(--font-serif); font-size: clamp(2.5rem, 7vw, 4rem); color: var(--color-gold); }
#game-rules-popup button { padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; background: var(--color-gold); color: var(--color-dark); cursor: none; font-weight: 600; margin-top: 20px; transition: transform 0.2s; }
#game-rules-popup button:hover { transform: scale(1.05); }
#game-result { display: none; }
#fireworks-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }

/* === Trang Fan Mail & Cuối === */
#fanmail-page { background-color: #d1e4dd; }
#fanmail-page .page-content { display: flex; justify-content: center; align-items: center; gap: 50px; flex-wrap: wrap; }
.chat-window { width: 400px; height: 75vh; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); border: 10px solid black; border-radius: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; flex-direction: column; }
.chat-header { padding: 15px; text-align: center; background: #005C4B; color: white; font-weight: 600; border-top-left-radius: 30px; border-top-right-radius: 30px; }
.message-area { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
.message-bubble { padding: 10px 15px; border-radius: 18px; max-width: 70%; line-height: 1.5; opacity: 0; transform: translateY(20px); transition: 0.5s; }
.message-bubble.visible { opacity: 1; transform: translateY(0); }
.message-bubble.sender { background-color: #dcf8c6; align-self: flex-end; border-bottom-right-radius: 4px; color: black; }
.fanmail-image { width: 300px; height: 420px; object-fit: cover; border: 8px solid white; box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-radius: 5px; opacity: 0; transform: scale(0.8) rotate(5deg); transition: opacity 1s var(--ease-out-expo), transform 1s var(--ease-out-expo); }
.fanmail-image.visible { opacity: 1; transform: scale(1) rotate(0deg); }
#back-cover-page { background-color: var(--color-paper); text-align: center; }
.back-cover-image { width: 60%; max-width: 700px; border: 20px solid white; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
.back-cover-text { font-family: var(--font-serif); font-size: clamp(1.8rem, 5vw, 3rem); margin-top: 40px; }
.credits { font-size: 1rem; font-style: italic; color: #777; margin-top: 20px; }

/* === Responsive === */
@media (max-width: 1024px) {
.page { padding: 10vh 5vw; }
#fanmail-page .page-content { flex-direction: column; gap: 30px; }
}
@media (max-width: 768px) {
/* NÂNG CẤP V2: Điều chỉnh hiệu ứng lật trang cho mobile */
.page {
transform-origin: center center;
transform: translateY(50px) scale(0.9);
}
.page.is-visible {
transform: translateY(0) scale(1);
}

.page { min-height: auto; padding: 15vw 5vw; }
#cover-page .page-content { flex-direction: column; text-align: center; }
.cover-image-wrapper { width: 80%; margin-bottom: 30px; }
.cover-text { text-align: center; }
#fashion-page .page-content { flex-direction: column; }
.fashion-text { width: 100%; text-align: center; }
.fashion-gallery { width: 100%; height: 50vh; margin-top: 40px; } .fashion-gallery img { width: 65%; }
#game-container { height: 60vh; }
.chat-window { width: 90vw; height: 70vh; }
.fanmail-image { width: 200px; height: 280px; }
.back-cover-image { width: 90%; }
}
</style>
</head>
<body>

<div id="preloader">
    <div class="preloader-text">The Queen</div>
    <div class="preloader-panel left"></div>
    <div class="preloader-panel right"></div>
</div>

<div id="lens-flare"></div>

<div id="scroll-progress-bar"></div>
<div class="cursor dot"></div>
<div class="cursor outline"></div>

<div id="curtain-lock-screen">
    <div class="curtain left-curtain"></div>
    <div class="curtain right-curtain"></div>
    <div class="password-overlay" id="password-overlay">
        <div class="password-box" id="password-box">
            <h2>Một Món Quà Bất Ngờ</h2>
            <p>Nhập mật khẩu (ddmm)</p>
            <input type="password" id="password-input" maxlength="4" autocomplete="off">
        </div>
    </div>
</div>

<div id="music-control" style="display: none;">  🎵  </div>

<main id="magazine-content" style="visibility: hidden;">
    <section id="cover-page" class="page">
        <canvas id="particle-canvas"></canvas>
        <div class="page-content">
            <div class="cover-image-wrapper animated">
                <img src="anh/anh_bia.jpg" alt="Ảnh bìa" class="cover-image">
            </div>
            <div class="cover-text">
                <p class="magazine-title animated delay-1">The Queen</p>
                <h1 class="headline" data-text-reveal>20.10</h1>
                <div class="tits animated delay-3">
                    <p>• Nhan sắc vượt thời gian</p>
                    <p>• Phong cách của một biểu tượng</p>
                </div>
            </div>
        </div>
    </section>

    <section id="fashion-page" class="page">
        <div class="page-content">
            <div class="fashion-text">
                <h2 class="animated" data-text-reveal>Fashionista</h2>
                <p class="quote animated delay-1">"Phong cách là cách để nói bạn là ai mà không cần phải tốn một lời."</p>
                <p class="animated delay-2">Từ những khoảnh khắc đời thường đến những dịp đặc biệt, thần thái và gu thẩm mỹ của mẹ luôn là nguồn cảm hứng bất tận.</p>
            </div>
            <div class="fashion-gallery animated delay-3">
                <img src="anh/anh1.jpg" alt="Ảnh 1">
                <img src="anh/anh2.jpg" alt="Ảnh 2">
            </div>
        </div>
    </section>

    <section id="game-page" class="page">
        <div class="page-content spotlight-effect">
            <div id="game-container">
                <canvas id="gameCanvas"></canvas>
                <div id="game-score">Điểm: 0</div>
                <div id="game-rules-popup">
                    <h3>Idol Challenge</h3>
                    <p>Di chuyển  🎤  để hứng quà, né bom!<br>Đạt 80 điểm để chiến thắng!</p>
                    <button id="startGameBtn">Bắt đầu!</button>
                </div>
                <div id="game-result">
                    <h3 id="result-message"></h3>
                    <canvas id="fireworks-canvas"></canvas>
                </div>
            </div>
        </div>
    </section>

    <section id="fanmail-page" class="page">
        <div class="page-content">
            <div class="chat-window animated">
                <div class="chat-header">Tin nhắn từ Fan Cứng</div>
                <div class="message-area"></div>
            </div>
            <img src="anh/anh3.jpg" alt="Ảnh fanmail" class="fanmail-image">
        </div>
    </section>

    <section id="back-cover-page" class="page">
        <div class="page-content">
            <img src="anh/anhgiadinh.jpg" alt="Ảnh gia đình" class="back-cover-image animated">
            <p class="back-cover-text animated delay-1" data-text-reveal>Cảm ơn mẹ vì đã là nguồn cảm hứng vô tận.</p>
            <p class="credits animated delay-2">Biên tập: Một mình Bi :3</p>
        </div>
    </section>
</main>

<audio id="backgroundMusic" src="anh/am_nhac.mp3" loop></audio>
<audio id="collectSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_2b33a52239.mp3"></audio>
<audio id="bombSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_c483740443.mp3"></audio>
<audio id="winSound" src="https://cdn.pixabay.com/audio/2022/11/17/audio_88b22280a5.mp3"></audio>

<svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none">
  <defs>
    <filter id="image-ripple-filter">
      <feTurbulence type="fractalNoise" baseFrequency="0.01 0.04" numOctaves="1" result="turbulence" seed="0"></feTurbulence>
      <feDisplacementMap in2="turbulence" in="SourceGraphic" scale="0" xChannelSelector="R" yChannelSelector="G"></feDisplacementMap>
    </filter>
  </defs>
</svg>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const mainContent = document.getElementById('magazine-content');

    // === KHU VỰC NÂNG CẤP MỚI V2 ===
    // --- 0. NÂNG CẤP V2: XỬ LÝ MÀN HÌNH CHỜ "SPLIT REVEAL" ---
    const preloader = document.getElementById('preloader');
    const curtainScreen = document.getElementById('curtain-lock-screen');
    setTimeout(() => {
        preloader.classList.add('revealed');
        setTimeout(() => {
            curtainScreen.classList.add('visible');
            passwordInput.focus();
        }, 1000); // Đợi preloader chạy xong mới hiện màn rèm khóa
    }, 2000); // Thời gian hiển thị chữ "The Queen"

    // --- NÂNG CẤP V2: LOGIC HIỆU ỨNG GỢN SÓNG ---
    const coverImageWrapper = document.querySelector('.cover-image-wrapper');
    const displacementMap = document.querySelector('#image-ripple-filter feDisplacementMap');
    let rippleAnimation;
    coverImageWrapper.addEventListener('mouseenter', () => {
        cancelAnimationFrame(rippleAnimation);
        let scale = 0;
        function animateRipple() {
            scale += (30 - scale) * 0.1; // Tăng cường độ gợn sóng lên 30
            displacementMap.setAttribute('scale', scale);
            if (Math.abs(30 - scale) > 0.1) {
                rippleAnimation = requestAnimationFrame(animateRipple);
            }
        }
        animateRipple();
    });
    coverImageWrapper.addEventListener('mouseleave', () => {
        cancelAnimationFrame(rippleAnimation);
        let scale = parseFloat(displacementMap.getAttribute('scale'));
        function animateRippleOut() {
            scale -= scale * 0.1; // Giảm dần về 0
            displacementMap.setAttribute('scale', scale);
            if (scale > 0.1) {
                rippleAnimation = requestAnimationFrame(animateRippleOut);
            } else {
                 displacementMap.setAttribute('scale', 0);
            }
        }
        animateRippleOut();
    });
    // === KẾT THÚC KHU VỰC NÂNG CẤP MỚI V2 ===


    // --- 1. HIỆU ỨNG CON TRỎ CHUỘT ---
    const cursorDot = document.querySelector('.cursor.dot');
    const cursorOutline = document.querySelector('.cursor.outline');
    const root = document.documentElement;
    window.addEventListener('mousemove', e => {
        const posX = e.clientX;
        const posY = e.clientY;
        cursorDot.style.left = `${posX}px`;
        cursorDot.style.top = `${posY}px`;
        cursorOutline.animate({ left: `${posX}px`, top: `${posY}px` }, { duration: 500, fill: "forwards" });
        root.style.setProperty('--cursor-x', `${posX}px`);
        root.style.setProperty('--cursor-y', `${posY}px`);
        handleMagneticEffect(musicControl, e, 40);
    });
    document.body.addEventListener('click', e => {
        const clickEffect = document.createElement('div');
        clickEffect.className = 'click-effect';
        clickEffect.style.left = `${e.clientX}px`;
        clickEffect.style.top = `${e.clientY}px`;
        document.body.appendChild(clickEffect);
        setTimeout(() => clickEffect.remove(), 500);
    });

    // --- 2. MÀN HÌNH KHÓA & NHẠC NỀN ---
    const passwordInput = document.getElementById('password-input');
    const passwordBox = document.getElementById('password-box');
    const backgroundMusic = document.getElementById('backgroundMusic');
    const musicControl = document.getElementById('music-control');
    passwordInput.addEventListener('input', () => {
        if (passwordInput.value === '0901') {
            curtainScreen.classList.add('open');
            mainContent.style.visibility = 'visible';
            document.body.classList.add('unlocked'); // NÂNG CẤP V2: Kích hoạt lens flare
            setTimeout(() => {
                curtainScreen.style.display = 'none';
                cursorOutline.classList.remove('hidden');
                document.querySelector('#cover-page .page-content')?.classList.add('spotlight-effect');
                startParticleAnimation();
            }, 3000);
            backgroundMusic.volume = 0.4;
            backgroundMusic.play().catch(e => console.log("Trình duyệt chặn tự động phát nhạc."));
            musicControl.style.display = 'flex';
            musicControl.textContent = '  🎵  ';
        } else if (passwordInput.value.length >= 4) {
            passwordBox.classList.add('shake');
            setTimeout(() => { passwordBox.classList.remove('shake'); passwordInput.value = ''; }, 500);
        }
    });
    musicControl.addEventListener('click', () => {
        if (backgroundMusic.paused) {
            backgroundMusic.play(); musicControl.textContent = '  🎵  ';
        } else {
            backgroundMusic.pause(); musicControl.textContent = '  🔇  ';
        }
    });

    // --- 3. HIỆU ỨNG KHI CUỘN TRANG ---
    const progressBar = document.getElementById('scroll-progress-bar');
    const parallaxPage = document.getElementById('game-page');
    const lensFlare = document.getElementById('lens-flare'); // NÂNG CẤP V2
    window.addEventListener('scroll', () => {
        const scrollTop = window.scrollY;
        const docHeight = document.documentElement.scrollHeight;
        const winHeight = window.innerHeight;
        const scrollPercent = (scrollTop / (docHeight - winHeight)) * 100;
        progressBar.style.width = `${scrollPercent}%`;

        // NÂNG CẤP V2: Cập nhật vị trí lens flare
        if (lensFlare) {
            const flareX = scrollPercent * 1.5; // Di chuyển nhanh hơn scroll
            const flareY = scrollPercent * 0.8;
            lensFlare.style.transform = `translate(${flareX / 100 * winHeight}px, ${flareY / 100 * winHeight}px)`;
        }

        if (parallaxPage) {
            const pageRect = parallaxPage.getBoundingClientRect();
            if (pageRect.top < winHeight && pageRect.bottom > 0) {
                const parallaxOffset = -scrollTop * 0.3;
                parallaxPage.style.backgroundPosition = `50% ${parallaxOffset}px`;
            }
        }
    });

    // IntersectionObserver
    const pages = document.querySelectorAll('.page');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                const textRevealEl = entry.target.querySelector('[data-text-reveal]');
                if (textRevealEl && !textRevealEl.classList.contains('revealed')) {
                    revealText(textRevealEl);
                }
                if (entry.target.id === 'fanmail-page') {
                    startFanMailAnimation();
                    const fanmailImage = document.querySelector('#fanmail-page .fanmail-image');
                    if (fanmailImage) setTimeout(() => fanmailImage.classList.add('visible'), 500);
                }
            }
        });
    }, { threshold: 0.35 }); // Tăng threshold để hiệu ứng lật trang kích hoạt mượt hơn
    pages.forEach(page => observer.observe(page));

    // Hàm Text Reveal
    function revealText(element) {
        const text = element.textContent;
        element.innerHTML = '';
        element.classList.add('revealed');
        text.split('').forEach((char, index) => {
            const span = document.createElement('span');
            span.className = 'char';
            span.textContent = (char === ' ') ? '\u00A0' : char;
            span.style.transitionDelay = `${index * 50}ms`;
            element.appendChild(span);
        });
        setTimeout(() => {
            element.querySelectorAll('.char').forEach(span => {
                span.style.opacity = '1';
                span.style.transform = 'translateY(0) rotate(0)';
            });
        }, 100);
    }

    // --- 4. HIỆU ỨNG TRANG FASHION ---
    const gallery = document.querySelector('.fashion-gallery');
    if (gallery) {
        const images = gallery.querySelectorAll('img');
        gallery.addEventListener('mousemove', (e) => {
            const rect = gallery.getBoundingClientRect();
            const mouseXRatio = (e.clientX - rect.left) / rect.width;
            let activeImage = null;
            if (mouseXRatio < 0.5) {
                images[0].classList.add('is-active'); images[1].classList.remove('is-active');
                activeImage = images[0];
            } else {
                images[1].classList.add('is-active'); images[0].classList.remove('is-active');
                activeImage = images[1];
            }
            if(activeImage) {
                const imgRect = activeImage.getBoundingClientRect();
                const x = e.clientX - imgRect.left;
                const y = e.clientY - imgRect.top;
                const rotateY = -1 * ((x - imgRect.width / 2) / (imgRect.width / 2)) * 15;
                const rotateX = ((y - imgRect.height / 2) / (imgRect.height / 2)) * 15;
                activeImage.style.transform = `scale(1.1) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            }
        });
        gallery.addEventListener('mouseleave', () => {
            images.forEach(img => {
                img.classList.remove('is-active');
                img.style.transform = '';
            });
        });
    }

    // --- CÁC HÀM CÓ SẴN (GAME, FANMAIL, PARTICLE, MAGNETIC) ---
    // Mã nguồn cho các hàm này không thay đổi và được giữ nguyên
    // ... (Toàn bộ mã nguồn gốc của các hàm này nằm ở đây) ...
    function startFanMailAnimation(){/*...code gốc...*/const messageArea=document.querySelector(".message-area");if(!messageArea||messageArea.children.length>0)return;const messages=[{text:"Hi Mom!",sticker:!1},{text:"  🥰  ",sticker:!0},{text:"Chúc mẹ một ngày 20/10 thật nhiều niềm vui và hạnh phúc ạ!",sticker:!1},{text:"Mẹ mãi là người phụ nữ tuyệt vời nhất trong lòng con! Yêu mẹ!  ❤️  ",sticker:!1}];let delay=500;messages.forEach(msg=>{setTimeout(()=>{const bubble=document.createElement("div");bubble.classList.add("message-bubble","sender"),msg.sticker&&(bubble.style.background="none",bubble.style.fontSize="3rem"),bubble.textContent=msg.text,messageArea.appendChild(bubble),setTimeout(()=>bubble.classList.add("visible"),50),messageArea.scrollTop=messageArea.scrollHeight},delay),delay+=1500})}function startParticleAnimation(){const canvas=document.getElementById("particle-canvas");if(!canvas)return;const ctx=canvas.getContext("2d");let particles=[];function resizeCanvas(){canvas.width=window.innerWidth,canvas.height=window.innerHeight}resizeCanvas(),window.addEventListener("resize",resizeCanvas);class Particle{constructor(){this.x=Math.random()*canvas.width,this.y=Math.random()*canvas.height,this.size=Math.random()*2+1,this.speedX=0,this.speedY=.1+Math.random()*.5,this.opacity=.2+Math.random()*.5}update(){this.y+=this.speedY,this.y>canvas.height&&(this.y=-this.size,this.x=Math.random()*canvas.width)}draw(){ctx.beginPath(),ctx.arc(this.x,this.y,this.size,0,2*Math.PI),ctx.fillStyle=`rgba(201, 171, 129, ${this.opacity})`,ctx.fill()}}function initParticles(){for(let i=0;i<150;i++)particles.push(new Particle)}function animateParticles(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let i=0;i<particles.length;i++)particles[i].update(),particles[i].draw();requestAnimationFrame(animateParticles)}initParticles(),animateParticles()}function handleMagneticEffect(element,event,force){if(!element||window.innerWidth<768)return;const rect=element.getBoundingClientRect(),centerX=rect.left+rect.width/2,centerY=rect.top+rect.height/2,mouseX=event.clientX,mouseY=event.clientY,deltaX=mouseX-centerX,deltaY=mouseY-centerY;Math.sqrt(deltaX*deltaX+deltaY*deltaY)<150?(element.style.transform=`translate(${deltaX*(force/150)}px, ${deltaY*(force/150)}px) scale(1.1)`,cursorOutline.style.transform="translate(-50%, -50%) scale(1.5)"):(element.style.transform="translate(0, 0) scale(1)",cursorOutline.style.transform="translate(-50%, -50%) scale(1)")}const gameContainer=document.getElementById("game-container"),canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),scoreEl=document.getElementById("game-score"),rulesPopup=document.getElementById("game-rules-popup"),resultScreen=document.getElementById("game-result"),resultMessage=document.getElementById("result-message"),audio={collect:document.getElementById("collectSound"),bomb:document.getElementById("bombSound"),win:document.getElementById("winSound")};let score,player,items,gameLoopId;function startGame(){score=0,items=[],scoreEl.textContent=`Điểm: ${score}`,player={x:canvas.width/2-25,y:canvas.height-70,width:50,height:60,emoji:"  🎤  "},gameLoopId=setInterval(gameLoop,16.666666666666668)}function gameLoop(){Math.random()<.05&&spawnItem(),updateGame(),drawGame()}function spawnItem(){const itemTypes=[{emoji:"  ❤️  ",value:5,type:"good"},{emoji:"  ⭐  ",value:10,type:"good"},{emoji:"  💣  ",value:-15,type:"bad"}],type=itemTypes[Math.floor(Math.random()*itemTypes.length)];items.push({x:Math.random()*(canvas.width-40),y:-40,size:40,speed:2+3*Math.random(),...type})}function updateGame(){items.forEach((item,index)=>{item.y+=item.speed,item.y>canvas.height&&items.splice(index,1),player.x<item.x+item.size&&player.x+player.width>item.x&&player.y<item.y+item.size&&player.y+player.height>item.y&&(score=Math.max(0,score+item.value),scoreEl.textContent=`Điểm: ${score}`,items.splice(index,1),("good"===item.type?audio.collect:audio.bomb).play(),score>=80&&endGame(!0))})}function drawGame(){ctx.clearRect(0,0,canvas.width,canvas.height),ctx.font="50px sans-serif",ctx.fillText(player.emoji,player.x,player.y),items.forEach(item=>{ctx.font=`${item.size}px sans-serif`,ctx.fillText(item.emoji,item.x,item.y)})}function endGame(isWin){clearInterval(gameLoopId),resultScreen.style.display="flex",resultMessage.textContent=isWin?"XUẤT SẮC!":"Cố Lên Nào!",isWin&&(audio.win.play(),launchFireworks()),document.getElementById("replayBtn")||(const replayBtn=document.createElement("button");replayBtn.id="replayBtn",replayBtn.textContent="Chơi lại",replayBtn.style.cssText="padding: 15px 30px; font-size: 1.2rem; border: none; border-radius: 50px; background: var(--color-gold); color: var(--color-dark); cursor: none; font-weight: 600; margin-top: 20px; z-index:20;",replayBtn.onclick=()=>{resultScreen.style.display="none",rulesPopup.style.display="flex"},resultScreen.appendChild(replayBtn))}function movePlayer(clientX){if(!player)return;const rect=canvas.getBoundingClientRect();player.x=Math.max(0,Math.min(clientX-rect.left-player.width/2,canvas.width-player.width))}function resizeCanvas(){canvas&&(canvas.width=gameContainer.clientWidth,canvas.height=gameContainer.clientHeight)}function launchFireworks(){const fwCanvas=document.getElementById("fireworks-canvas"),fwCtx=fwCanvas.getContext("2d");fwCanvas.width=fwCanvas.clientWidth,fwCanvas.height=fwCanvas.clientHeight;let fireworks=[],particles=[];function Firework(sx,sy,tx,ty){this.x=sx,this.y=sy,this.sx=sx,this.sy=sy,this.tx=tx,this.ty=ty,this.distanceToTarget=Math.sqrt(Math.pow(tx-sx,2)+Math.pow(ty-sy,2)),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;for(;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(ty-sy,tx-sx),this.speed=2,this.acceleration=1.05,this.brightness=50+50*Math.random(),this.targetRadius=1}Firework.prototype.update=function(index){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetRadius<8?this.targetRadius+=.3:this.targetRadius=1,this.speed*=this.acceleration;let vx=Math.cos(this.angle)*this.speed,vy=Math.sin(this.angle)*this.speed;this.distanceTraveled=Math.sqrt(Math.pow(this.x-this.sx,2)+Math.pow(this.y-this.sy,2)),this.distanceTraveled>=this.distanceToTarget?(createParticles(this.tx,this.ty),fireworks.splice(index,1)):(this.x+=vx,this.y+=vy)},Firework.prototype.draw=function(){fwCtx.beginPath(),fwCtx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),fwCtx.lineTo(this.x,this.y),fwCtx.strokeStyle="hsl(" + 360*Math.random() + ", 100%, " + this.brightness + "%)",fwCtx.stroke()};function Particle(x,y){this.x=x,this.y=y,this.coordinates=[],this.coordinateCount=5;for(;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=2*Math.random()*Math.PI,this.speed=1+10*Math.random(),this.friction=.95,this.gravity=1,this.hue=360*Math.random(),this.brightness=50+50*Math.random(),this.alpha=1,this.decay=.015+.03*Math.random()}Particle.prototype.update=function(index){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&particles.splice(index,1)},Particle.prototype.draw=function(){fwCtx.beginPath(),fwCtx.moveTo(this.coordinates[this.coordinates.length-1][0],this.coordinates[this.coordinates.length-1][1]),fwCtx.lineTo(this.x,this.y),fwCtx.strokeStyle="hsla(" + this.hue + ", 100%, " + this.brightness + "%, " + this.alpha + ")",fwCtx.stroke()};function createParticles(x,y){let particleCount=30;for(;particleCount--;)particles.push(new Particle(x,y))}let fireworkInterval=setInterval(()=>{let startX=fwCanvas.width/2,startY=fwCanvas.height,endX=Math.random()*fwCanvas.width,endY=Math.random()*fwCanvas.height/2;fireworks.push(new Firework(startX,startY,endX,endY))},800);let animationLoop=()=>{requestAnimationFrame(animationLoop),fwCtx.globalCompositeOperation="destination-out",fwCtx.fillStyle="rgba(0, 0, 0, 0.5)",fwCtx.fillRect(0,0,fwCanvas.width,fwCanvas.height),fwCtx.globalCompositeOperation="lighter";let i=fireworks.length;for(;i--;)fireworks[i].draw(),fireworks[i].update(i);for(i=particles.length;i--;)particles[i].draw(),particles[i].update(i)};animationLoop(),setTimeout(()=>{clearInterval(fireworkInterval)},5e3)}document.getElementById("startGameBtn")?.addEventListener("click",()=>{rulesPopup.style.display="none",resizeCanvas(),startGame()}),canvas.addEventListener("mousemove",e=>movePlayer(e.clientX)),canvas.addEventListener("touchmove",e=>{e.preventDefault(),movePlayer(e.touches[0].clientX)}),window.addEventListener("resize",resizeCanvas),resizeCanvas();
});
</script>
</body>
</html>
